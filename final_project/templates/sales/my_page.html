{% extends 'base.html' %}

{% block content %}
<div class="container-fluid my-3 px-5">
    <div class="row">
        <!-- 왼쪽 열: 사용자 정보 -->
        <div class="col-md-2" style="background-color:skyblue;">
            <div class="text-center ">
                <h3>사용자 정보</h3>
                <!-- 사용자가 선택한 이미지 or 디폴트 이미지 -->
                <img src="{% if user.profile_image %}{{ user.profile_image.url }}{% else %}/static/uploads/user_default.png{% endif %}" alt="프로필 이미지" class="rounded-circle mb-3" style="width: 100%; max-width: 200px;">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" name="profile_image"> <!-- 파일 업로드 필드 -->
                    <button type="submit" class="btn btn-primary">업로드</button>
                </form>
                <p><strong>이름:</strong> {{ user.username }}</p>
                <p><strong>이메일:</strong> {{ user.email }}</p>
                <p><strong>전화번호:</strong> {{ user.phone_number }}</p>
                <a href="{% url 'common:delete_user' user.id  %}" 
                class="btn btn-sm btn-outline-secondary">회원 탈퇴</a> 
                <!-- 기타 사용자 정보 필드들을 추가로 출력할 수 있음 -->
            </div>
            <!-- 사용자 정보 출력 부분 이후에 추가 -->
            <div class="text-center ">
                <h3>TestSangmin 정보</h3>
                {% if test_sangmin_instance %}
                    <p><strong>SEQ:</strong> {{ test_sangmin_instance.seq }}</p>
                    {% if test_sangmin_instance.interior_am %}
                        <p><strong>가전/가구/주방용품 :</strong> {{ test_sangmin_instance.interior_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.insuhos_am %}
                        <p><strong>보험/병원 :</strong> {{ test_sangmin_instance.insuhos_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.offedu_am %}
                        <p><strong>사무통신/서적/학원 :</strong> {{ test_sangmin_instance.offedu_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.trvlec_am %}
                        <p><strong>여행/레져/문화 :</strong> {{ test_sangmin_instance.trvlec_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.fsbz_am %}
                        <p><strong>요식업 :</strong> {{ test_sangmin_instance.fsbz_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.svcarc_am %}
                        <p><strong>용역/수리/건축자재 :</strong> {{ test_sangmin_instance.svcarc_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.dist_am %}
                        <p><strong>유통 :</strong> {{ test_sangmin_instance.dist_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.plsanit_am %}
                        <p><strong>보건위생 :</strong> {{ test_sangmin_instance.plsanit_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.clothgds_am %}
                        <p><strong>의류/신변잡화 :</strong> {{ test_sangmin_instance.clothgds_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.auto_am %}
                        <p><strong>자동차/연료/정비 :</strong> {{ test_sangmin_instance.auto_am }}</p>
                    {% endif %}
                    {% if test_sangmin_instance.car_price %}
                        <p><strong>Car Price:</strong> {{ test_sangmin_instance.car_price }}</p>
                    {% endif %}
                {% else %}
                    <p>TestSangmin 정보가 없습니다.</p>
                {% endif %}
            </div>
            
        </div>

        <!-- 오른쪽 열: 좋아요한 게시글 목록 -->
        
        <div class="col-md-9">
            <div class="tab" style="display: flex; justify-content: flex-end;">
                <button class="tablinks" onclick="openCity(event, 'Paris')">나의 소비 내역<span id="carCount"></span></button>
                <button class="tablinks" onclick="openCity(event, 'MySales')">내 판매 내역({{user_cars_for_sale_count}})<span id="userCarCount"></span></button>

                <button class="tablinks active" onclick="openCity(event, 'London')" id="defaultOpen">관심있는 차량({{ liked_car_count }})</button>
            </div>
            <!-- 내 판매 내역 탭 -->
            <div id="MySales" class="tabcontent" style="display: none;">
                <div class="user-sales">
                    {% if user_cars_for_sale %}
                    <div class="row">
                        {% for car in user_cars_for_sale %}
                        <div class="col-md-3 mb-4">
                            <div class="card">
                                <div class="card-body clickable-card">
                                    <img src="/static/uploads/sampleCAR.jpg" class="card-img-top" alt="대표 사진" width="200" height="200">
                                    <p class="card-text"> </p>
                                    <div class="card-title my-3" style="height: 40px;">
                                        <a href="{% url 'sales:detail' car.post_id %}" style="text-decoration: none; color: inherit;">
                                            <strong>{{ car.MNAME }}</strong>
                                        </a>
                                    </div>
                                    <div>
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">{{ car.MYERAR }}년식</p>
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">{{ car.MILEAGE }}km | {{ car.seller.address }}</p>
                                    </div>
                                    <div class="text-end">
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">
                                            <span style="font-size: 20px; color: skyblue;"><strong>{{ car.PRICE }}</strong></span><span style="font-size: 12px;">만원</span>
                                        </p>   
                                    </div>                 
                                </div>
                            </div>
                        </div>
                        {% if forloop.counter|divisibleby:4 %}
                            </div><div class="row">
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <p>내 판매 내역이 없습니다.</p>
                    {% endif %}
                </div>
                <!-- 페이징처리 -->
                {% if user_cars_for_sale.has_other_pages %}
                <ul class="pagination justify-content-center mt-4">
                    {% if user_cars_for_sale.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?user_cars_for_sale_page=1">&laquo;</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">&laquo;</span>
                    </li>
                    {% endif %}
                    {% for num in user_cars_for_sale.paginator.page_range %}
                    {% if user_cars_for_sale.number == num %}
                    <li class="page-item active" aria-current="page">
                        <span class="page-link">{{ num }}<span class="sr-only"></span></span>
                    </li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?user_cars_for_sale_page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                    {% endfor %}
                    {% if user_cars_for_sale.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?user_cars_for_sale_page={{ user_cars_for_sale.paginator.num_pages }}">&raquo;</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">&raquo;</span>
                    </li>
                    {% endif %}
                </ul>
                {% endif %}
            </div>

            <!-- 내가 사고자 하는 차량 탭-->
            <div id="London" class="tabcontent">
                <div class="liked-posts ">
                    {% if liked_car %}
                    <div class="row">
                        {% for car in liked_car %}
                        <div class="col-md-3 mb-4">
                            <div class="card">
                                <div class="card-body clickable-card">
                                    <img src="/static/uploads/sampleCAR.jpg" class="card-img-top" alt="대표 사진" width="200" height="200">
                                    <p class="card-text"> </p>
                                    <div class="card-title my-3" style="height: 40px;">
                                        <a href="{% url 'sales:detail' car.post_id %}" style="text-decoration: none; color: inherit;">
                                            <strong>{{ car.MNAME }}</strong>
                                        </a>
                                    </div>
                                    <div>
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">{{ car.MYERAR }}년식</p>
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">{{ car.MILEAGE }}km | {{ car.seller.address }}</p>
                                    </div>
                                    <div class="text-end">
                                        <p style="font-size: 12px; margin-top: 0; margin-bottom: 0;">
                                            <span style="font-size: 20px; color: skyblue;"><strong>{{ car.PRICE }}</strong></span><span style="font-size: 12px;">만원</span>
                                        </p>   
                                    </div>                 
                                    {% comment %} <p class="card-text">글쓴이: {{ car.seller.username }}</p>
                                    <p class="card-text">작성일시: {{ car.create_date|date:"Y년 m월 d일" }}</p> {% endcomment %}
                                    {% comment %} <p> eqfeddddqf </p> {% endcomment %}         
                                </div>
                            </div>
                        </div>
                        {% if forloop.counter|divisibleby:4 %}
                            </div><div class="row">
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <p>좋아요한 게시글이 없습니다.</p>
                    {% endif %}
                </div>
                <!-- 페이징처리 -->
                {% if liked_car.has_other_pages %}
                <ul class="pagination justify-content-center mt-4">
                    {% if liked_car.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1">&laquo;</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">&laquo;</span>
                    </li>
                    {% endif %}
                    {% for num in liked_car.paginator.page_range %}
                    {% if liked_car.number == num %}
                    <li class="page-item active" aria-current="page">
                        <span class="page-link">{{ num }}<span class="sr-only"></span></span>
                    </li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                    {% endfor %}
                    {% if liked_car.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ liked_car.paginator.num_pages }}">&raquo;</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">&raquo;</span>
                    </li>
                    {% endif %}
                </ul>
                {% endif %}
            </div>

            
            <div id="Paris" class="tabcontent">
                <div class="text-center ">
                    <h3>TestSangmin 정보</h3>
                    <canvas id="myChart" width="250" height="250"></canvas>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                    var ctx = document.getElementById('myChart').getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: [
                            {% if test_sangmin_instance %}
                                {% if test_sangmin_instance.interior_am > 0 %}'가전/가구/주방용품',{% endif %}
                                {% if test_sangmin_instance.insuhos_am > 0 %}'보험/병원',{% endif %}
                                {% if test_sangmin_instance.offedu_am > 0 %}'사무통신/서적/학원',{% endif %}
                                {% if test_sangmin_instance.trvlec_am > 0 %}'여행/레져/문화',{% endif %}
                                {% if test_sangmin_instance.fsbz_am > 0 %}'요식업',{% endif %}
                                {% if test_sangmin_instance.svcarc_am > 0 %}'용역/수리/건축자재',{% endif %}
                                {% if test_sangmin_instance.dist_am > 0 %}'유통',{% endif %}
                                {% if test_sangmin_instance.plsanit_am > 0 %}'보건위생',{% endif %}
                                {% if test_sangmin_instance.clothgds_am > 0 %}'의류/신변잡화',{% endif %}
                                {% if test_sangmin_instance.auto_am > 0 %}'자동차/연료/정비',{% endif %}
                        {% endif %}
                        ],
                            datasets: [{
                                label: 'TestSangmin 정보',
                                data: [
                                    {% if test_sangmin_instance %}
                                        {% if test_sangmin_instance.interior_am > 0 %} {{ test_sangmin_instance.interior_am }}, {% endif %}
                                        {% if test_sangmin_instance.insuhos_am > 0 %} {{ test_sangmin_instance.insuhos_am }}, {% endif %}
                                        {% if test_sangmin_instance.offedu_am > 0 %} {{ test_sangmin_instance.offedu_am }}, {% endif %}
                                        {% if test_sangmin_instance.trvlec_am > 0 %} {{ test_sangmin_instance.trvlec_am }}, {% endif %}
                                        {% if test_sangmin_instance.fsbz_am > 0 %} {{ test_sangmin_instance.fsbz_am }}, {% endif %}
                                        {% if test_sangmin_instance.svcarc_am > 0 %} {{ test_sangmin_instance.svcarc_am }}, {% endif %}
                                        {% if test_sangmin_instance.dist_am > 0 %} {{ test_sangmin_instance.dist_am }}, {% endif %}
                                        {% if test_sangmin_instance.plsanit_am > 0 %} {{ test_sangmin_instance.plsanit_am }}, {% endif %}
                                        {% if test_sangmin_instance.clothgds_am > 0 %} {{ test_sangmin_instance.clothgds_am }}, {% endif %}
                                        {% if test_sangmin_instance.auto_am > 0 %} {{ test_sangmin_instance.auto_am }}, {% endif %}
                                {% else %}
                                    0
                                {% endif %}
                                ],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)',
                                    'rgba(255, 159, 64, 0.2)',
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)'
                                ],
                                borderWidth: 1
                            }]
                        }
                    });
                </script>
            </div>
            
              
              
            
    </div>
</div>
{% endblock %}
{% block script %}
<script type='text/javascript'>


document.addEventListener("DOMContentLoaded", function() {
    var cardBodyElements = document.querySelectorAll(".clickable-card");
    cardBodyElements.forEach(function(cardBodyElement) {
        cardBodyElement.addEventListener("click", function() {
            var detailUrl = this.querySelector(".card-title a").getAttribute("href");
            window.location.href = detailUrl;
        });
    });
});
</script>
{% endblock %}